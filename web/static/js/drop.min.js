/*  {{ the drop }}
 *  version 0.01, 2013-07-14
 *
 *  By Dave Cave (caveman), Nick Skelton (shredder) and Gareth Stokes (garrydanger) */

rainEmitter=gamvas.ParticleEmitter.extend({create:function(e,t,n,r,i){var s=gamvas.getCanvasDimension();this._super(e,0,-s.h*.5-20,r,i);var o=gamvas.state.getCurrentState(),u=new gamvas.Image(o.resource.getImage("media/drop.png"));u.setCenter(1,30),this.setImage(u),this.aligntoPath=!0,this.setParticleRate(4),this.setParticleStartPositionRange(new gamvas.Vector2D(s.w*.6,0)),this.setAlphaTable([[0,.5],[1,.8]]),this.setParticleSpeed(s.h*1.5),this.setParticleSpeedRange(s.h*.3),this.setParticleLifeTime(.45),this.setParticleLifeTimeRange(.06),this.setRotation(.15),this.splashCounter=0,this.splashImage=o.resource.getImage("media/splash.png"),this.splashes=[]},draw:function(e){var t=[];for(var n=0;n<this.splashes.length;n++)this.splashes[n].draw(e),this.splashes[n].lifeTime<.5?t.push(this.splashes[n]):delete this.splashes[n].draw(e);this.splashes=t,this._super(e)},onParticleEnd:function(e,t,n,r){var i=new gamvas.Image(this.splashImage);i.setCenter(16,16);var s=new gamvas.ParticleEmitter("splash"+this.splashCounter,e.x,e.y,i);s.setParticleLimit(1),s.setAlphaTable([[0,0],[.01,.2],[.1,.5],[1,0]]),s.setScaleTable([[0,.2],[.3,.5],[1,1]]),s.setParticleSpeed(0),s.setParticleLifeTime(.4),this.splashes.push(s),this.splashCounter++}}),rainState=gamvas.State.extend({init:function(){this.emitter=new rainEmitter("rain"),this.addActor(this.emitter),this.dim=gamvas.getCanvasDimension(),this.clearColor="#323232",this.autoClear=!0},preDraw:function(e){},postDraw:function(e){},loading:function(e){var t=gamvas.getCanvasDimension(),n=t.h/2-5,r=parseInt(t.w*.7,10),i=parseInt((t.w-r)/2,10)}}),window.drop=function(){"use strict";function e(e){$(e).css({top:"50%",left:"50%","margin-top":"-150px","margin-left":"-"+$(e).width()/2+"px"})}function r(){$("#message #form").fadeOut(500),setTimeout(function(){$(".logo").animate({top:"+=150px"},200,function(){$(this).css({width:"50px",top:"200px",left:"0px"}),this.src="media/splash.png?time="+(new Date).getTime(),$(this).animate({width:"300px",opacity:0,top:"-=100px",left:"-=100px"},500)})},800)}function i(e){$("#error").css({margin:"8px 0px 8px 32px",width:"180px"}).html(e)}function s(){e("#message"),$("#message").fadeIn(400),$("#sign-in-with-facebook").mousedown(function(){$(this).addClass("fb-down")}).mouseup(function(){$(this).removeClass("fb-down")});var t="Give us your email...";$("input").focus(),$("input").val("Give us your email..."),$("input").keydown(function(){this.value===t&&(this.value="")}).focusout(function(){this.value===""&&(this.value=t)}).focusout(function(){$("form").submit()}),$("form").submit(function(){var e=$("#email").val();return e===t?!1:e.indexOf("@")===-1?(i("that email is not valid."),!1):($.ajax({method:"post",url:$(this).attr("action"),data:$(this).serialize()}).success(function(t){if(t.ok===!1)return i(t.result),!1;r(),setTimeout(function(){$("#message").remove(),o()},2e3),n.persist(e)}).error(function(e,t){$(".error").html(t)}),!1)})}function o(){e("#thank-you"),$("#thank-you").css({"margin-left":"+=45"}),$("#thank-you").fadeIn(500),$("#thank-you").append('<br /><br /><input type="button" value="clear local storage"></input>').click(function(){n.clear(),window.location="rain.html"})}var t="drop-registered",n={};typeof window.localStorage=="object"&&(n={get:function(){return window.localStorage[t]},persist:function(e){window.localStorage[t]=e},clear:function(){delete window.localStorage[t]}}),typeof n.get()=="undefined"?s():o()};